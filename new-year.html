<!--
 * @Author: Tina Huang
 * @Date: 2022-12-10 21:42:42
 * @LastEditors: Tina Huang
 * @LastEditTime: 2022-12-30 15:05:24
 * @Description: 
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: rgba(0, 5, 24, 1);
      }

      .city {
        width: 100%;
        position: fixed;
        bottom: 0px;
        z-index: 100;
        z-index: 10;
      }

      .city img {
        width: 100%;
      }

      #labels,
      #extra {
        /* color: rgb(106, 17, 11); */

        color: #daf6ff;
        text-shadow: 0 0 20px #0aafe6, 0 0 20px rgba(10, 175, 230, 0);
        font-weight: bold;
        font-size: 3.8rem;
        position: fixed;
        width: 100vw;
        text-align: center;
        opacity: 0;
        transition: all 0.5s ease-in-out;
        z-index: 100;
        top: 30%;
      }
      #labels.hide {
        opacity: 0;
        transform: scale(1);
      }
      #labels.show,
      #extra.show {
        opacity: 1;
        z-index: 100;
        transform: scale(1.3);
      }
    </style>
    <title>Happy New Year</title>
  </head>
  <body onselectstart="return false">
    <canvas id="cas">浏览器不支持canvas</canvas>
    <div id="labels"></div>
    <div class="city"><img src="./city_2.png" alt="" /></div>
    <img src="./moon.png" alt="" id="moon" style="visibility: hidden" />
    <div id="labels"></div>

    <script>
      let __audio = document.createElement("audio");
      // ❤️ 修改音乐在这里
      __audio.src = "http://music.163.com/song/media/outer/url?id=28828078.mp3";
      __audio.loop = true;
      __audio.volume = 0.6;
      window.onclick = function () {
        __audio.play();
      };
    </script>
    <script>
      let starCount = 1500;
      let starArr = new Array();

      // 💗 ‼️ ‼️ 想要说的话在这里 💗
      const my_labels = [

        " ",
        "蕾蕾",
        "2023快乐！",
        "新的一年也要发光发热！",
        " ",
        "好啦，没有啦",
        " ",
        "真的没有啦",
        "别看了",
        "再看也没有了",        
        " ",
        " ",
        "诶，居然还在看嘛",
        " ",
        "那就说了嗷",
        "新的一年，依旧喜欢你",
        "喜欢你喜欢你！好好记住啦",
        "去年这时候我们也在一起过的吧",
        "啊想想真是很开心呢",
        "马上就寒假了",
        "一起去看展呀...虽然不知道能不能出来",
        "总之，可以的话一起去吧！",
        "一时想不出还有什么要说了",
        "那就以后慢慢说吧！",
        "新的一年，一起加油鸭",
        "对了，别忘了哈我之前说的什么来着",
        "你一定有好好记住哒对吧嘿嘿",
        "就这样啦，后面没了",
        "真的没啦，可以关掉了",
        "拜拜",
      ];
      const shapes = [
        // "img$http://www.html5tricks.com/wp-content/uploads/2015/03/html5-canvas-drag-tree.png"
      ];
      let canvas = document.getElementById("cas");
      let ocas = document.createElement("canvas");
      let octx = ocas.getContext("2d");
      let ctx = canvas.getContext("2d");
      ocas.width = canvas.width = window.innerWidth;
      ocas.height = canvas.height = window.innerHeight;
      let bigbooms = [];

      window.onload = function () {
        initAnimate();

        const labels = document.getElementById("labels");
        for (let i = 0; i < my_labels.length; i++) {
          setTimeout(() => {
            // labels.className = "hide";
            labels.innerHTML = my_labels[i];
            labels.className = "show";
            if (i < my_labels.length - 1) {
              setTimeout(() => {
                labels.className = "hide";
              }, 3000);
            }
          }, 3500 * (i + 1));
        }

        for (let i = 0; i < starCount; i++) {
          let star = new StarMore();
          star.randomColor();
          starArr.push(star);
        }

        showStars();
      };

      function initAnimate() {
        drawBg();

        lastTime = new Date();
        animate();
      }

      let lastTime;
      function animate() {
        ctx.save();
        ctx.globalCompositeOperation = "destination-out";
        ctx.globalAlpha = 0.1;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.restore();

        let newTime = new Date();
        if (newTime - lastTime > 200 + (window.innerHeight - 767) / 2) {
          let random = Math.random() * 100 > 2 ? true : false;
          let x = getRandom(canvas.width / 5, (canvas.width * 4) / 5);
          let y = getRandom(50, 200);
          if (random) {
            let bigboom = new Boom(
              getRandom(canvas.width / 3, (canvas.width * 2) / 3),
              2,
              "#FFF",
              { x: x, y: y }
            );
            bigbooms.push(bigboom);
          } else {
            let bigboom = new Boom(
              getRandom(canvas.width / 3, (canvas.width * 2) / 3),
              2,
              "#FFF",
              {
                x: canvas.width / 2,
                y: 200,
              },
              shapes[parseInt(getRandom(0, shapes.length))]
            );
            bigbooms.push(bigboom);
          }
          lastTime = newTime;
        }

        stars.foreach(function () {
          this.paint();
        });

        drawMoon();

        bigbooms.foreach(function (index) {
          let that = this;
          if (!this.dead) {
            this._move();
            this._drawLight();
          } else {
            this.booms.foreach(function (index) {
              if (!this.dead) {
                this.moveTo(index);
              } else if (index === that.booms.length - 1) {
                bigbooms.splice(bigbooms.indexOf(that), 1);
              }
            });
          }
        });

        raf(animate);
      }

      function drawMoon() {
        let moon = document.getElementById("moon");
        let centerX = canvas.width - 200,
          centerY = 100,
          width = 80;
        if (moon.complete) {
          ctx.drawImage(moon, centerX, centerY, width, width);
        } else {
          moon.onload = function () {
            ctx.drawImage(moon, centerX, centerY, width, width);
          };
        }
        let index = 0;
        for (let i = 0; i < 10; i++) {
          ctx.save();
          ctx.beginPath();
          ctx.arc(
            centerX + width / 2,
            centerY + width / 2,
            width / 2 + index,
            0,
            2 * Math.PI
          );
          ctx.fillStyle = "rgba(240,219,120,0.005)";
          index += 2;
          ctx.fill();
          ctx.restore();
        }
      }

      Array.prototype.foreach = function (callback) {
        for (let i = 0; i < this.length; i++) {
          if (this[i] !== null) callback.apply(this[i], [i]);
        }
      };

      let raf =
        window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function (callback) {
          window.setTimeout(callback, 1000 / 10);
        };

      canvas.onclick = function () {
        let x = event.clientX;
        let y = event.clientY;
        let bigboom = new Boom(
          getRandom(canvas.width / 3, (canvas.width * 2) / 3),
          2,
          "#FFF",
          { x: x, y: y }
        );
        bigbooms.push(bigboom);
      };

      let Boom = function (x, r, c, boomArea, shape) {
        this.booms = [];
        this.x = x;
        this.y = canvas.height + r;
        this.r = r;
        this.c = c;
        this.shape = shape || false;
        this.boomArea = boomArea;
        this.theta = 0;
        this.dead = false;
        this.ba = parseInt(getRandom(80, 200));

        let audio = document.getElementsByTagName("audio");
        for (let i = 0; i < audio.length; i++) {
          if (
            audio[i].src.indexOf("shotfire") >= 0 &&
            (audio[i].paused || audio[i].ended)
          ) {
            // audio[i].play();
            break;
          }
        }
      };
      Boom.prototype = {
        _paint: function () {
          ctx.save();
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.r, 0, 2 * Math.PI);
          ctx.fillStyle = this.c;
          ctx.fill();
          ctx.restore();
        },
        _move: function () {
          let dx = this.boomArea.x - this.x,
            dy = this.boomArea.y - this.y;
          this.x = this.x + dx * 0.01;
          this.y = this.y + dy 
